version: '2.1'
services:
  fpl-service:
    build:
      context: .
      args:
        - http_proxy
        - https_proxy
        - no_proxy
    image: hmctspublic.azurecr.io/fpl/case-service
    container_name: fpl-service
    environment:
      - IDAM_API_URL=http://idam-api:5000
      - DOCMOSIS_TORNADO_URL=http://docmosis-tornado:8080
      - DOCMOSIS_TORNADO_KEY
      - DOCUMENT_MANAGEMENT_URL=http://dm-store:8080
      - CORE_CASE_DATA_API_URL=http://ccd-data-store-api:4452
      - IDAM_S2S_AUTH_URL=http://service-auth-provider-api:8080
      - CCD_UI_BASE_URL=http://localhost:3451
      - SPRING_PROFILES_ACTIVE=local,user-mappings
      - NOTIFY_API_KEY
      # these environment variables are used by java-logging library
    ports:
      - $SERVER_PORT:$SERVER_PORT
    networks:
      - default
      - ccd-network
  docmosis-tornado:
    image: mikehodgson/tornado
    environment:
      # not supported in current version of Tornado
      - DOCMOSIS_KEY=0OAD-KLTK-JALO-DLIA-EBBH-1ELH-YBKQ-GS91-23ED-8-E499
      - DOCMOSIS_SITE="Free Trial License"
    volumes:
      - ./docker/docmosis/templates:/home/docmosis/templates:rw
    ports:
      - 5433:8080
  wiremock:
    image: rodolpheche/wiremock
    volumes:
      - ./docker/wiremock:/home/wiremock:rw
    ports:
      - 8765:8080
  send-letter-service:
    image: hmctspublic.azurecr.io/rpe/send-letter-service:latest
    container_name: send-letter-service
    environment:
      - APPINSIGHTS_INSTRUMENTATIONKEY=
      - LETTER_TRACKING_DB_PASSWORD=password
      - FLYWAY_NOOP_STRATEGY=false
      - FTP_HOSTNAME=localhost
      - FTP_PORT=22
      - FTP_TARGET_FOLDER=TARGET
      - FTP_REPORTS_FOLDER=REPORTS
      - FTP_FINGERPRINT=fingerprint
      - FTP_USER=user
      - FTP_PRIVATE_KEY=private
      - FTP_PUBLIC_KEY=public
      - S2S_URL=false
    ports:
    - 8485:8485
networks:
  ccd-network:
      external: true
