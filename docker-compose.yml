version: '2.1'
services:
  fpl-service:
    build:
      context: .
      args:
        - http_proxy
        - https_proxy
        - no_proxy
    image: hmctspublic.azurecr.io/fpl/case-service
    container_name: fpl-service
    environment:
      - IDAM_API_URL=http://idam-api:5000
      - DOCMOSIS_TORNADO_URL=http://docmosis-tornado:8080
      - DOCMOSIS_TORNADO_KEY
      - DOCUMENT_MANAGEMENT_URL=http://dm-store:8080
      - CORE_CASE_DATA_API_URL=http://ccd-data-store-api:4452
      - IDAM_S2S_AUTH_URL=http://service-auth-provider-api:8080
      - CCD_UI_BASE_URL=http://localhost:3451
      - SPRING_PROFILES_ACTIVE=local,user-mappings
      - NOTIFY_API_KEY
      # these environment variables are used by java-logging library
    ports:
      - $SERVER_PORT:$SERVER_PORT
    networks:
      - default
      - ccd-network

  collector:
    image: auviknetworks/collector:latest
    container_name: "fpl-service-auvik"
    hostname: "servicenow.eu1.my.auvik.com"
    environment:
      AUVIK_USERNAME: "dawud.rahman@justice.gov.uk"
      AUVIK_API_KEY: "e1e3cccd-9f52-4d31-86e3-2dc551d3b780"
      AUVIK_DOMAIN_PREFIX: "servicenow"
    cap_add:
      - NET_ADMIN
    volumes:
      - './config/:/config/'
      - './etc/auvik/:/etc/auvik/'
      - './logs/:/usr/share/agent/logs/'
    restart: unless-stopped
networks:
  ccd-network:
      external: true
