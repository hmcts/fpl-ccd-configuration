#!groovy

properties([
  pipelineTriggers([cron('20 21 * * *')])
])

@Library("Infrastructure")

def type = "java"

def product = "fpl"
def component = "fpl-service"

List<Map<String, Object>> secrets = [
  secret('ccd-configurer-s2s-secret', 'CCD_CONFIGURER_S2S_SECRET'),
  secret('address-lookup-api-key', 'ADDRESS_LOOKUP_TOKEN')
]

withNightlyPipeline(type, product, component) {
  setVaultName('fpl')
  loadVaultSecrets(secrets)
  env.URL = 'http://ccd-case-management-web-aat.service.core-compute-aat.internal';
  env.PROXY_SERVER = "proxyout.reform.hmcts.net:8080";

//  enableMutationTest()
//
//  after('mutationTest') {
//    withSonarQubeEnv("SonarQube") {
//      sh "./gradlew --info sonarqube"
//    }
//  }

  //to Run functional test
  after('build') {
    stage ("functionalTests"){
      sh '''./gradlew functional'''
    }
  }
  //sh "./gradlew functional"
  //enableFullFunctionalTest()
}
