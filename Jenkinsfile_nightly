#!groovy

properties([
  pipelineTriggers([cron('20 21 * * *')])
])

@Library("Infrastructure")

def type = "java"

def product = "fpl"
def component = "case-service"

List<Map<String, Object>> secrets = [
  secret('ccd-configurer-s2s-secret', 'CCD_CONFIGURER_S2S_SECRET'),
  secret('address-lookup-api-key', 'ADDRESS_LOOKUP_TOKEN')
]

static Map<String, Object> secret(String secretName, String envVariable) {
  [ $class: 'AzureKeyVaultSecret',
    secretType: 'Secret',
    name: secretName,
    envVariable: envVariable
  ]
}

withNightlyPipeline(type, product, component) {
  setVaultName('fpl-aat')
  loadVaultSecrets(secrets)
  env.URL = 'http://ccd-case-management-web-aat.service.core-compute-aat.internal';
  env.PROXY_SERVER = "proxyout.reform.hmcts.net:8080";
  env.SKIP_FUNCTIONAL_TESTS = 'true'

//  enableMutationTest()
//
//  after('mutationTest') {
//    withSonarQubeEnv("SonarQube") {
//      sh "./gradlew --info sonarqube"
//    }
//  }

  //to Run functional test
  after('DependencyCheckNightly') {
    stage ("functionalTests"){
      sh '''./gradlew functional'''
    }
  }
  //sh "./gradlew functional"
  //enableFullFunctionalTest()
}
