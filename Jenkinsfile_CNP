#!groovy

@Library("Infrastructure")

import uk.gov.hmcts.contino.Kubectl

def type = "java"

def product = "fpl"
def component = "fpl-service"

withPipeline(type, product, component) {
  enableDockerBuild()
  enableDeployToAKS()
  // enableSlackNotifications('#fpl-tech')

  after('aksdeploy') {
    echo params
    echo env

    def subscription = params.subscription
    def aksServiceName = 'fpl-fpl-service-pr-41'

    def kubectl = new Kubectl(this, subscription, aksServiceName)
    def ingressIP = kubectl.getServiceLoadbalancerIP("traefik", "kube-system")

    echo ingressIP

    // registerConsulDns(subscription, aksServiceName, ingressIP)
  }
}
